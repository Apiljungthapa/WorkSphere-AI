<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Employee Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', path='/dashboard.css') }}">
    
</head>

<body>
    <div class="container">
        <aside class="sidebar" id="sidebar">
            <h2>WorkSphere AI 
                <i class="fas fa-times close-icon"></i>


            </h2>
            <nav>
                
                <a href="/feedback"><i class="fas fa-comment-alt"></i> Feedback</a>

                <a href="/view_announcements?mark_as_read=true" class="announcement-link">
                    <i class="fas fa-sync-alt"></i>
                    Announcements
                    <span id="announcement-indicator" style="color: red; font-size: 14px; display: none;">ðŸ”´</span>
                  </a>

 

                <a href="/logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                  </a>

            </nav>
        </aside>
        <main class="main-content" id="mainContent">
            <div class="top-bar">

                

                <div class="left-section">
                    <button class="hamburger-menu"><a href=""><i class="fas fa-bars"></i></a></button>
                    <div class="welcome-message">Welcome, {{ user_full_name }}</div>
                </div>

                <div class="right-section">

                    <!-- <a href="/view_notifications" class="notify">
                        <i class="fas fa-bell"></i>
                        <span class= "notify-counter" id="notification-indicator" style="color: red; font-size: 8px; display: none;"></span>
                      </a> -->

                      <a href="/view_notifications" class="notify">
                        <i class="fas fa-bell"></i>
                        {% if show_red_dot %}
                        <span class="notify-counter" id="notification-indicator"
                            style="color: red; font-size: 8px; display: inline;">
                            
                        </span>
                        {% else %}
                        <span class="notify-counter" id="notification-indicator"
                            style="display: none;">
                        </span>
                        {% endif %}
                    </a>
                    

                    <a href="/profile" style="background: none; border: none; cursor: pointer;">
                        <i class="fas fa-user-circle" style="color: white; font-size: 1.5rem;"></i>
                    </a>

                   
                      

                </div>
            </div>

            <div class="card-container">
                <div class="card gradient-card blue">
                    <h3><i class="fas fa-user-check"></i> Total Attendance</h3>
                    <p class="large">95%</p>
                    <p>Last 30 days</p>
                </div>
                <div class="card gradient-card green">
                    <h3><i class="fas fa-calendar-check"></i> Leave Balance</h3>
                    <p class="large">12 days</p>
                    <p>Remaining this year</p>
                </div>
            </div>


            
            <h2>My Departments</h2>
            <div class="card-container">

                <!-- <div class="card clickable-card" onclick="location.href='/final_templates/emp_details.html' ">
                    <h3><i class="fas fa-laptop-code"></i> AI</h3>
                    <p>Ayush Adhikari - Department Head</p>
                    <div class="badges">
                        <span class="badge badge-blue">5 Projects</span>
                        <span class="badge badge-green">12 Members</span>
                    </div>
                </div>  -->


                <a href="/emp_details" style="text-decoration: none; color: inherit;">
                    <div class="card clickable-card">
                        <h3><i class="fas fa-laptop-code"></i> {{ department_name }}</h3>
                        <p>{{ department_head }} - Department Head</p>
                        <div class="badges">
                            <span class="badge badge-green">{{ department_members_count }} Members</span>
                        </div>
                    </div>
                </a>
                
            </div>
    </div>
    </main>
    </div>

    <a href="chatbot.html" style="text-decoration: none;">
        <button class="chat-toggle">
            <i class="fas fa-comment-dots"></i>
        </button>
    </a>

    <script>
  async function checkUnreadAnnouncements() {
        const response = await fetch("/check_unread_announcements");
        const data = await response.json();
        const redDot = document.getElementById("announcement-indicator");

        if (data.unread) {
            redDot.style.display = "inline";  // Show red dot
        } else {
            redDot.style.display = "none";  // Hide red dot
        }
    }

    checkUnreadAnnouncements();

    document.addEventListener("DOMContentLoaded", function() {
    fetch('/check-unread')
        .then(response => response.json())
        .then(data => {
            if (data.unread) {
                document.getElementById("notification-indicator").style.display = "inline";
            }
        });
});

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector(".notify").addEventListener("click", function() {
        fetch("/mark_notifications_as_read")
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById("notification-indicator").style.display = "none";
                }
            });
    });
});

        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const openBtn = document.getElementById('openBtn');
        const closeIcon = document.querySelector('.close-icon'); // Updated to select the close icon

        // Initially hide close button and icon on larger screens
        if (window.innerWidth > 768) {
            openBtn.style.display = 'none';
            closeIcon.style.display = 'none'; // Updated to hide close icon
        }

        // Open Sidebar on small screens
        openBtn.addEventListener('click', () => {
            sidebar.classList.add('open');
            mainContent.classList.add('sidebar-open');
            openBtn.style.display = 'none';
            closeIcon.style.display = 'block'; // Show close icon when sidebar is open
        });

        // Close Sidebar on small screens
        closeIcon.addEventListener('click', () => {
            sidebar.classList.remove('open');
            mainContent.classList.remove('sidebar-open');
            openBtn.style.display = 'block';
            closeIcon.style.display = 'none'; // Hide close icon when sidebar is closed
        });

        // Ensure hamburger menu and close icon are hidden on larger screens after resizing
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                openBtn.style.display = 'none';
                closeIcon.style.display = 'none'; // Updated to hide close icon on larger screens
                sidebar.classList.remove('open');
                mainContent.classList.remove('sidebar-open');
            } else {
                openBtn.style.display = 'block';
                closeIcon.style.display = 'none'; // Updated to show hamburger menu only
            }
        });

    </script>
</body>

</html>